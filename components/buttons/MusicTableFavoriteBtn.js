import React, { useEffect, useState } from "react";
import { useTranslation } from "next-i18next";
import { toast } from "react-toastify";
import { get } from "../../utils/request";
import useUser from "../../utils/useUser";

export default function MusicTableFavoriteBtn({ model, type = "music", className = "" }) {

    const [favorite, setFavorite] = useState(false);

    const { user, mutate } = useUser();

    const { t } = useTranslation();

    useEffect(() => {
        setFavorite(model.favorite);
    }, [model.favorite]);

    const handleClick = async () => {

        let res = type === "album" ? await get(`account/favorite-album?album_id=${model.id}`) : (type === "music" ? await get(`account/favorite-music?music_id=${model.id}`) : await get(`account/favorite-album?album_id=${model.id}`));

        if (res?.status === 'liked') {
            setFavorite(true);
            toast.success(t('Добавлено в понравившиеся'), { toastId: "video-favorite", updateId: 'video-favorite', hideProgressBar: true })
        } else {
            setFavorite(false);
            toast.dismiss("video-favorite")
        }
    }

    return (
        user ? (
            <a role="button" onClick={() => {
                handleClick();
            }}>
                <div className="favorite favorite-element">
                    {favorite ? (
                        <svg className="liked-heart favorite-element" xmlns="http://www.w3.org/2000/svg" width="21" height="19" viewBox="0 0 21 19" fill="none">
                            <path fillRule="evenodd" clipRule="evenodd" d="M0.563329 0.10325C0.370145 0.172116 0.161984 0.373238 0.104889 0.546204C-0.00198782 0.87012 0.164174 1.26149 0.471782 1.41041L0.644474 1.49402L5.1182 1.48362L9.59193 1.47317L9.73663 1.38323C9.91362 1.27315 10.0296 1.09326 10.0646 0.874421C10.1172 0.545344 9.87506 0.179155 9.54411 0.087256C9.44497 0.0597253 7.96915 0.0467421 5.05563 0.0477198C1.465 0.0489712 0.688664 0.0585522 0.563329 0.10325ZM13.4292 0.102351C13.2296 0.174697 13.0224 0.379769 12.9745 0.552461C12.9499 0.640802 12.9359 3.01278 12.9357 7.09467C12.9356 10.6167 12.9289 13.4983 12.9209 13.4983C12.9128 13.4983 12.8288 13.455 12.7341 13.402C11.8863 12.9282 10.6252 12.8023 9.62029 13.091C8.49595 13.4141 7.65181 14.1406 7.33524 15.0576C7.20647 15.4306 7.20647 16.1413 7.33524 16.5143C7.58228 17.2299 8.14141 17.8284 8.91849 18.2089C9.83826 18.6593 10.9022 18.7625 11.9083 18.499C13.039 18.2029 13.9358 17.4379 14.2541 16.4983L14.3629 16.177L14.3739 11.8243L14.385 7.47149L14.4717 7.49758C14.5194 7.51189 14.7449 7.61978 14.9728 7.7373C16.3218 8.43272 17.3111 9.69314 17.6295 11.1218L17.6794 11.3459L17.5267 11.5658C17.2877 11.9101 17.2373 12.0197 17.2372 12.1955C17.2371 12.4809 17.3844 12.7251 17.636 12.8565C17.7723 12.9277 18.11 12.9274 18.2481 12.856C18.4655 12.7436 18.8721 12.218 19.2033 11.6212C19.5292 11.0341 19.8485 10.0781 20.0002 9.23572C20.1052 8.65332 20.0943 7.71606 19.9771 7.24131C19.7967 6.51062 19.4979 5.87761 19.0753 5.33079C18.645 4.774 18.254 4.44465 17.0025 3.58478C15.7469 2.72203 15.4987 2.50186 14.9491 1.76338C14.6209 1.32238 14.4037 0.925611 14.3608 0.688433C14.3274 0.503618 14.2828 0.408473 14.1722 0.286501C13.9942 0.0899934 13.6789 0.0118595 13.4292 0.102351ZM0.467245 4.43139C0.161202 4.58289 -0.00112748 4.97273 0.106336 5.29833C0.165425 5.47736 0.413045 5.70034 0.612329 5.75399C0.720379 5.78309 2.11994 5.79279 5.16063 5.78544C10.0269 5.7737 9.66917 5.79353 9.89677 5.52303C10.1996 5.16306 10.0941 4.63087 9.67992 4.43041L9.5086 4.34747L5.07261 4.34751L0.636653 4.34755L0.467245 4.43139ZM0.480307 8.71072C0.303978 8.80266 0.222442 8.88709 0.143174 9.05974C0.00301776 9.36497 0.0935091 9.71723 0.365374 9.92461L0.513195 10.0374L2.8235 10.0489C4.09421 10.0552 5.19141 10.0499 5.26176 10.0372C5.42077 10.0083 5.65611 9.80636 5.72626 9.63844C5.87776 9.27584 5.69248 8.82519 5.33661 8.69074C5.26333 8.66305 4.45282 8.64921 2.91204 8.64937C0.889591 8.6496 0.582765 8.65734 0.480307 8.71072ZM0.563329 12.9685C0.369754 13.0383 0.161866 13.2395 0.104889 13.4121C-0.00175318 13.7353 0.164213 14.1274 0.470452 14.2757C0.639038 14.3573 0.678379 14.3586 2.91841 14.3586C5.33888 14.3586 5.35085 14.3578 5.55697 14.1714C5.89536 13.8654 5.83052 13.2718 5.43316 13.0382L5.25117 12.9312L2.98301 12.9226C1.12278 12.9154 0.687608 12.9237 0.563329 12.9685Z" fill="white" />
                        </svg>
                    ) : (
                        <svg className="favorite-element" xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
                            <path fillRule="evenodd" clipRule="evenodd" d="M0.552183 0.0247777C-0.0496921 0.169784 -0.19509 0.969041 0.31857 1.30897L0.477101 1.41387H4.99717H9.51727L9.6547 1.31968C10.0303 1.06234 10.1011 0.597027 9.8162 0.258469C9.58853 -0.0121188 9.94846 0.00746293 5.07534 0.000622989C2.65693 -0.00277744 0.621521 0.0080883 0.552183 0.0247777ZM13.4258 0.0337674C13.2307 0.0753934 13.0767 0.187099 12.9636 0.369042L12.8729 0.514908L12.8626 6.97377C12.8568 10.5261 12.8408 13.4326 12.8269 13.4326C12.813 13.4326 12.7267 13.3887 12.6351 13.3351C12.4015 13.1982 11.8999 13.019 11.5379 12.9431C11.1072 12.8529 10.2847 12.8599 9.82421 12.9577C8.2416 13.2939 7.14804 14.4223 7.14804 15.7191C7.14804 17.8499 9.96859 19.2254 12.3428 18.2524C13.4144 17.8132 14.1212 16.9814 14.2572 15.9997C14.2853 15.796 14.2995 14.3117 14.2995 11.5537C14.2995 9.27656 14.3106 7.41348 14.3243 7.41348C14.3379 7.41348 14.5105 7.48993 14.7077 7.58338C16.1463 8.26487 17.214 9.57283 17.5454 11.0598L17.5958 11.2861L17.4387 11.5093C17.2118 11.8316 17.1527 11.9623 17.1527 12.1421C17.1527 12.5434 17.4571 12.8463 17.86 12.8463C18.1914 12.8463 18.3686 12.6977 18.7975 12.0599C19.5696 10.9115 20.069 9.17267 19.9922 7.89974C19.9449 7.11443 19.6259 6.18717 19.1743 5.52147C18.7413 4.88344 18.2344 4.42864 17.055 3.62028C15.7392 2.71839 15.4287 2.45026 14.9252 1.78139C14.5538 1.28806 14.3679 0.961732 14.2719 0.63451C14.24 0.525735 14.1787 0.379165 14.1356 0.308772C14.005 0.0950142 13.6973 -0.0241962 13.4258 0.0337674ZM15.2859 4.11897C15.485 4.26706 15.903 4.56204 16.2147 4.77447C17.6934 5.78229 18.1289 6.27613 18.4501 7.30943C18.5233 7.545 18.5374 7.68231 18.5387 8.17564C18.5403 8.7824 18.4633 9.36341 18.3964 9.24955C17.9532 8.49559 17.7205 8.17404 17.3124 7.75145C16.9772 7.40445 16.559 7.04928 16.156 6.76935C15.7885 6.51404 15.0129 6.1203 14.6194 5.98928L14.2995 5.88274V4.57252V3.2623L14.6117 3.55602C14.7834 3.71756 15.0868 3.97091 15.2859 4.11897ZM0.39166 4.37052C0.138074 4.49603 0.0135871 4.70842 0.0144861 5.01403C0.0151114 5.2281 0.0301202 5.27672 0.135885 5.40761C0.202252 5.48973 0.316264 5.5921 0.389237 5.63509C0.519782 5.71201 0.592168 5.71326 4.95808 5.71326C7.39799 5.71326 9.44231 5.69982 9.50105 5.6834C9.66701 5.63693 9.87107 5.43396 9.94412 5.24275C10.0733 4.90455 9.92415 4.52671 9.59947 4.36955L9.42824 4.28665L4.99459 4.28669L0.560978 4.28672L0.39166 4.37052ZM0.366723 8.67523C0.281361 8.72358 0.171844 8.82196 0.123378 8.89391C-0.1109 9.24154 -0.00153892 9.69536 0.366723 9.90392L0.521892 9.99182L2.83516 9.99249C4.3761 9.99292 5.18517 9.97924 5.25845 9.95152C5.83993 9.73182 5.83993 8.84732 5.25845 8.62762C5.18517 8.59991 4.3761 8.58623 2.83516 8.58666L0.521892 8.58733L0.366723 8.67523ZM0.552183 12.8836C0.379817 12.9255 0.254118 13.0137 0.124511 13.1836C0.0322699 13.3046 0.0149942 13.3649 0.014447 13.5682C0.0136262 13.8728 0.140263 14.0864 0.394865 14.2096C0.563362 14.2912 0.602682 14.2925 2.84153 14.2925C5.26072 14.2925 5.27268 14.2916 5.4787 14.1054C5.81691 13.7995 5.7521 13.2063 5.35496 12.9728L5.17305 12.8659L2.92564 12.8594C1.68957 12.8558 0.621521 12.8667 0.552183 12.8836ZM11.4658 14.3921C12.0235 14.5399 12.5452 14.9029 12.7453 15.2822C12.8104 15.4055 12.8315 15.5125 12.8315 15.7191C12.8315 16.0536 12.7478 16.2321 12.4568 16.5186C11.8589 17.1071 10.6939 17.3075 9.75644 16.9831C8.80869 16.6551 8.34624 15.9095 8.69414 15.2703C8.94518 14.8091 9.52001 14.4597 10.2346 14.3341C10.5202 14.2839 11.1738 14.3146 11.4658 14.3921Z" fill="white" />
                        </svg>

                    )}
                </div>
            </a >
        ) : (
            <div className="d-flex align-items-center">
                <a role="button" data-event="click" data-tip data-for={"favoriteTip"}>
                    <svg className="favorite-element" xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
                        <path fillRule="evenodd" clipRule="evenodd" d="M0.552183 0.0247777C-0.0496921 0.169784 -0.19509 0.969041 0.31857 1.30897L0.477101 1.41387H4.99717H9.51727L9.6547 1.31968C10.0303 1.06234 10.1011 0.597027 9.8162 0.258469C9.58853 -0.0121188 9.94846 0.00746293 5.07534 0.000622989C2.65693 -0.00277744 0.621521 0.0080883 0.552183 0.0247777ZM13.4258 0.0337674C13.2307 0.0753934 13.0767 0.187099 12.9636 0.369042L12.8729 0.514908L12.8626 6.97377C12.8568 10.5261 12.8408 13.4326 12.8269 13.4326C12.813 13.4326 12.7267 13.3887 12.6351 13.3351C12.4015 13.1982 11.8999 13.019 11.5379 12.9431C11.1072 12.8529 10.2847 12.8599 9.82421 12.9577C8.2416 13.2939 7.14804 14.4223 7.14804 15.7191C7.14804 17.8499 9.96859 19.2254 12.3428 18.2524C13.4144 17.8132 14.1212 16.9814 14.2572 15.9997C14.2853 15.796 14.2995 14.3117 14.2995 11.5537C14.2995 9.27656 14.3106 7.41348 14.3243 7.41348C14.3379 7.41348 14.5105 7.48993 14.7077 7.58338C16.1463 8.26487 17.214 9.57283 17.5454 11.0598L17.5958 11.2861L17.4387 11.5093C17.2118 11.8316 17.1527 11.9623 17.1527 12.1421C17.1527 12.5434 17.4571 12.8463 17.86 12.8463C18.1914 12.8463 18.3686 12.6977 18.7975 12.0599C19.5696 10.9115 20.069 9.17267 19.9922 7.89974C19.9449 7.11443 19.6259 6.18717 19.1743 5.52147C18.7413 4.88344 18.2344 4.42864 17.055 3.62028C15.7392 2.71839 15.4287 2.45026 14.9252 1.78139C14.5538 1.28806 14.3679 0.961732 14.2719 0.63451C14.24 0.525735 14.1787 0.379165 14.1356 0.308772C14.005 0.0950142 13.6973 -0.0241962 13.4258 0.0337674ZM15.2859 4.11897C15.485 4.26706 15.903 4.56204 16.2147 4.77447C17.6934 5.78229 18.1289 6.27613 18.4501 7.30943C18.5233 7.545 18.5374 7.68231 18.5387 8.17564C18.5403 8.7824 18.4633 9.36341 18.3964 9.24955C17.9532 8.49559 17.7205 8.17404 17.3124 7.75145C16.9772 7.40445 16.559 7.04928 16.156 6.76935C15.7885 6.51404 15.0129 6.1203 14.6194 5.98928L14.2995 5.88274V4.57252V3.2623L14.6117 3.55602C14.7834 3.71756 15.0868 3.97091 15.2859 4.11897ZM0.39166 4.37052C0.138074 4.49603 0.0135871 4.70842 0.0144861 5.01403C0.0151114 5.2281 0.0301202 5.27672 0.135885 5.40761C0.202252 5.48973 0.316264 5.5921 0.389237 5.63509C0.519782 5.71201 0.592168 5.71326 4.95808 5.71326C7.39799 5.71326 9.44231 5.69982 9.50105 5.6834C9.66701 5.63693 9.87107 5.43396 9.94412 5.24275C10.0733 4.90455 9.92415 4.52671 9.59947 4.36955L9.42824 4.28665L4.99459 4.28669L0.560978 4.28672L0.39166 4.37052ZM0.366723 8.67523C0.281361 8.72358 0.171844 8.82196 0.123378 8.89391C-0.1109 9.24154 -0.00153892 9.69536 0.366723 9.90392L0.521892 9.99182L2.83516 9.99249C4.3761 9.99292 5.18517 9.97924 5.25845 9.95152C5.83993 9.73182 5.83993 8.84732 5.25845 8.62762C5.18517 8.59991 4.3761 8.58623 2.83516 8.58666L0.521892 8.58733L0.366723 8.67523ZM0.552183 12.8836C0.379817 12.9255 0.254118 13.0137 0.124511 13.1836C0.0322699 13.3046 0.0149942 13.3649 0.014447 13.5682C0.0136262 13.8728 0.140263 14.0864 0.394865 14.2096C0.563362 14.2912 0.602682 14.2925 2.84153 14.2925C5.26072 14.2925 5.27268 14.2916 5.4787 14.1054C5.81691 13.7995 5.7521 13.2063 5.35496 12.9728L5.17305 12.8659L2.92564 12.8594C1.68957 12.8558 0.621521 12.8667 0.552183 12.8836ZM11.4658 14.3921C12.0235 14.5399 12.5452 14.9029 12.7453 15.2822C12.8104 15.4055 12.8315 15.5125 12.8315 15.7191C12.8315 16.0536 12.7478 16.2321 12.4568 16.5186C11.8589 17.1071 10.6939 17.3075 9.75644 16.9831C8.80869 16.6551 8.34624 15.9095 8.69414 15.2703C8.94518 14.8091 9.52001 14.4597 10.2346 14.3341C10.5202 14.2839 11.1738 14.3146 11.4658 14.3921Z" fill="white" />
                    </svg>
                </a>
            </div>
        )
    );
}